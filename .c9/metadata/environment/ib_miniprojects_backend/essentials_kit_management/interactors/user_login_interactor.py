{"filter":false,"title":"user_login_interactor.py","tooltip":"/ib_miniprojects_backend/essentials_kit_management/interactors/user_login_interactor.py","ace":{"folds":[],"scrolltop":244.5,"scrollleft":0,"selection":{"start":{"row":28,"column":30},"end":{"row":28,"column":47},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":22,"state":"start","mode":"ace/mode/python"}},"hash":"57ffeca41aa805bb2bc7f846c7c01b71a61a056e","undoManager":{"mark":26,"position":26,"stack":[[{"start":{"row":12,"column":0},"end":{"row":13,"column":0},"action":"insert","lines":["",""],"id":2}],[{"start":{"row":39,"column":45},"end":{"row":40,"column":0},"action":"insert","lines":["",""],"id":3},{"start":{"row":40,"column":0},"end":{"row":40,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":40,"column":46},"end":{"row":41,"column":0},"action":"insert","lines":["",""],"id":4},{"start":{"row":41,"column":0},"end":{"row":41,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":41,"column":8},"end":{"row":41,"column":12},"action":"remove","lines":["    "],"id":5}],[{"start":{"row":0,"column":0},"end":{"row":47,"column":23},"action":"remove","lines":["from essentials_kit_management.interactors.storages.user_storage_interface \\","    import UserStorageInterface","","from essentials_kit_management.interactors.presenters. \\","    user_presenter_interface import UserPresenterInterface","","from common.oauth2_storage import OAuth2SQLStorage","from common.oauth_user_auth_tokens_service import OAuthUserAuthTokensService","","from essentials_kit_management.exceptions.exceptions import (","    InvalidPassword, InvalidUsername",")","","","class UserLoginInteractor:","","    def __init__(self,","                 user_storage: UserStorageInterface,","                 user_presenter: UserPresenterInterface,","                 oauth2_storage: OAuth2SQLStorage):","","        self.user_storage = user_storage","        self.user_presenter = user_presenter","        self.oauth2_storage = oauth2_storage","","    def user_login(self, username: str, password: str):","","        try:","            self.user_storage.validate_password(password=password)","        except InvalidPassword:","            return self.user_presenter.raise_invalid_password_exception()","","        try:","            user_id = self.user_storage.validate_username(","                username=username,","                password=password)","        except InvalidUsername:","            return self.user_presenter.raise_invalid_username_exception()","","        service = OAuthUserAuthTokensService(","            oauth2_storage=self.oauth2_storage","        )","        acces_token_dto = service.create_user_auth_tokens(user_id=user_id)","","        response = self.user_presenter.get_access_token_response(","            acces_token_dto=acces_token_dto)","","        return response"],"id":6},{"start":{"row":0,"column":0},"end":{"row":48,"column":0},"action":"insert","lines":["from essentials_kit_management.interactors.storages.user_storage_interface \\","    import UserStorageInterface","","from essentials_kit_management.interactors.presenters. \\","    user_presenter_interface import UserPresenterInterface","","from common.oauth2_storage import OAuth2SQLStorage","from common.oauth_user_auth_tokens_service import OAuthUserAuthTokensService","","from essentials_kit_management.exceptions.exceptions import (","    InvalidPassword, InvalidUsername",")","","","class UserLoginInteractor:","","    def __init__(self,","                 user_storage: UserStorageInterface,","                 user_presenter: UserPresenterInterface,","                 oauth2_storage: OAuth2SQLStorage):","","        self.user_storage = user_storage","        self.user_presenter = user_presenter","        self.oauth2_storage = oauth2_storage","","    def user_login(self, username: str, password: str):","","        try:","            self.user_storage.validate_password(password=password)","        except InvalidPassword:","            return self.user_presenter.raise_invalid_password_exception()","","        try:","            user_id = self.user_storage.validate_username(","                username=username,","                password=password)","        except InvalidUsername:","            return self.user_presenter.raise_invalid_username_exception()","","        service = OAuthUserAuthTokensService(","            oauth2_storage=self.oauth2_storage","        )","        acces_token_dto = service.create_user_auth_tokens(user_id=user_id)","","        response = self.user_presenter.get_access_token_response(","            acces_token_dto=acces_token_dto)","","        return response",""]}],[{"start":{"row":27,"column":0},"end":{"row":31,"column":0},"action":"remove","lines":["        try:","            self.user_storage.validate_password(password=password)","        except InvalidPassword:","            return self.user_presenter.raise_invalid_password_exception()",""],"id":7}],[{"start":{"row":34,"column":0},"end":{"row":35,"column":0},"action":"insert","lines":["",""],"id":8},{"start":{"row":35,"column":0},"end":{"row":36,"column":0},"action":"insert","lines":["",""]},{"start":{"row":36,"column":0},"end":{"row":37,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":35,"column":0},"end":{"row":39,"column":0},"action":"insert","lines":["        try:","            self.user_storage.validate_password(password=password)","        except InvalidPassword:","            return self.user_presenter.raise_invalid_password_exception()",""],"id":9}],[{"start":{"row":39,"column":0},"end":{"row":40,"column":0},"action":"remove","lines":["",""],"id":10}],[{"start":{"row":35,"column":0},"end":{"row":39,"column":0},"action":"remove","lines":["        try:","            self.user_storage.validate_password(password=password)","        except InvalidPassword:","            return self.user_presenter.raise_invalid_password_exception()",""],"id":11}],[{"start":{"row":27,"column":0},"end":{"row":28,"column":0},"action":"insert","lines":["",""],"id":12}],[{"start":{"row":28,"column":0},"end":{"row":32,"column":0},"action":"insert","lines":["        try:","            self.user_storage.validate_password(password=password)","        except InvalidPassword:","            return self.user_presenter.raise_invalid_password_exception()",""],"id":13}],[{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"remove","lines":["",""],"id":14},{"start":{"row":39,"column":0},"end":{"row":40,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":26,"column":0},"end":{"row":27,"column":0},"action":"remove","lines":["",""],"id":15}],[{"start":{"row":30,"column":18},"end":{"row":30,"column":19},"action":"remove","lines":[" "],"id":16},{"start":{"row":30,"column":17},"end":{"row":30,"column":18},"action":"remove","lines":["n"]},{"start":{"row":30,"column":16},"end":{"row":30,"column":17},"action":"remove","lines":["r"]},{"start":{"row":30,"column":15},"end":{"row":30,"column":16},"action":"remove","lines":["u"]},{"start":{"row":30,"column":14},"end":{"row":30,"column":15},"action":"remove","lines":["t"]},{"start":{"row":30,"column":13},"end":{"row":30,"column":14},"action":"remove","lines":["e"]},{"start":{"row":30,"column":12},"end":{"row":30,"column":13},"action":"remove","lines":["r"]}],[{"start":{"row":37,"column":18},"end":{"row":37,"column":19},"action":"remove","lines":[" "],"id":17},{"start":{"row":37,"column":17},"end":{"row":37,"column":18},"action":"remove","lines":["n"]},{"start":{"row":37,"column":16},"end":{"row":37,"column":17},"action":"remove","lines":["r"]},{"start":{"row":37,"column":15},"end":{"row":37,"column":16},"action":"remove","lines":["u"]},{"start":{"row":37,"column":14},"end":{"row":37,"column":15},"action":"remove","lines":["t"]},{"start":{"row":37,"column":13},"end":{"row":37,"column":14},"action":"remove","lines":["e"]},{"start":{"row":37,"column":12},"end":{"row":37,"column":13},"action":"remove","lines":["r"]}],[{"start":{"row":32,"column":8},"end":{"row":38,"column":0},"action":"remove","lines":["try:","            user_id = self.user_storage.validate_username(","                username=username,","                password=password)","        except InvalidUsername:","            self.user_presenter.raise_invalid_username_exception()",""],"id":18}],[{"start":{"row":26,"column":0},"end":{"row":27,"column":0},"action":"insert","lines":["",""],"id":19},{"start":{"row":27,"column":0},"end":{"row":28,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":28,"column":0},"end":{"row":28,"column":4},"action":"insert","lines":["    "],"id":20}],[{"start":{"row":28,"column":4},"end":{"row":28,"column":8},"action":"insert","lines":["    "],"id":21}],[{"start":{"row":28,"column":8},"end":{"row":34,"column":0},"action":"insert","lines":["try:","            user_id = self.user_storage.validate_username(","                username=username,","                password=password)","        except InvalidUsername:","            self.user_presenter.raise_invalid_username_exception()",""],"id":22}],[{"start":{"row":26,"column":0},"end":{"row":27,"column":0},"action":"remove","lines":["",""],"id":23}],[{"start":{"row":39,"column":0},"end":{"row":40,"column":0},"action":"remove","lines":["        ",""],"id":24}],[{"start":{"row":27,"column":0},"end":{"row":33,"column":0},"action":"remove","lines":["        try:","            user_id = self.user_storage.validate_username(","                username=username,","                password=password)","        except InvalidUsername:","            self.user_presenter.raise_invalid_username_exception()",""],"id":25}],[{"start":{"row":32,"column":0},"end":{"row":33,"column":0},"action":"insert","lines":["",""],"id":26}],[{"start":{"row":33,"column":0},"end":{"row":39,"column":0},"action":"insert","lines":["        try:","            user_id = self.user_storage.validate_username(","                username=username,","                password=password)","        except InvalidUsername:","            self.user_presenter.raise_invalid_username_exception()",""],"id":27}],[{"start":{"row":26,"column":0},"end":{"row":27,"column":0},"action":"remove","lines":["",""],"id":28}]]},"timestamp":1591446307278}