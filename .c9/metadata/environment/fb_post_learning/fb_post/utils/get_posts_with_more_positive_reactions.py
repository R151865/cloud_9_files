{"changed":true,"filter":false,"title":"get_posts_with_more_positive_reactions.py","tooltip":"/fb_post_learning/fb_post/utils/get_posts_with_more_positive_reactions.py","value":"from django.db.models import Count, Q\nfrom fb_post.constants.enum_constants import ReactionChoices\nfrom fb_post.models import  Reaction\n\n\ndef get_postive_reactions_list():\n\n    positive_reactions = [ReactionChoices.WOW.value,\n                          ReactionChoices.LIT.value,\n                          ReactionChoices.LOVE.value,\n                          ReactionChoices.HAHA.value,\n                          ReactionChoices.THUMBS_UP.value\n                          ]\n\n    return positive_reactions\n\n\ndef get_negative_reactions_list(): # use in constants\n    negative_reactions = [ReactionChoices.THUMBS_DOWN.value,\n                          ReactionChoices.ANGRY.value,\n                          ReactionChoices.SAD.value\n                          ]\n\n    return negative_reactions\n\n\ndef get_postive_reaction_count():\n    positive_reactions = get_postive_reactions_list()\n\n    positive_reactions_count = Count('reaction',\n                                     filter=Q(\n                                         reaction__in=positive_reactions)\n                                    )\n    return positive_reactions_count\n\n\ndef get_negative_reactions_count():\n    negative_reactions = get_negative_reactions_list()\n\n    negative_reactions_count = Count('reaction',\n                                     filter=Q(\n                                         reaction__in=negative_reactions)\n                                    )\n    return negative_reactions_count\n\n\n# 10\ndef get_posts_with_more_positive_reactions():\n\n    positive_reactions_count = get_postive_reaction_count()\n    negative_reactions_count = get_negative_reactions_count()\n\n    return list(Reaction.objects.select_related('post')\\\n                        .values('post_id')\\\n                        .annotate(\n                            positive_reactions_count=positive_reactions_count,\n                            negative_reactions_count=negative_reactions_count)\\\n                        .filter(\n                            positive_reactions_count__gt=(\n                                negative_reactions_count)\n                                )\\\n                        .values_list('post_id', flat=True)\n               )\n\n","undoManager":{"mark":-2,"position":1,"stack":[[{"start":{"row":1,"column":22},"end":{"row":1,"column":23},"action":"insert","lines":["."],"id":2},{"start":{"row":1,"column":23},"end":{"row":1,"column":24},"action":"insert","lines":["e"]},{"start":{"row":1,"column":24},"end":{"row":1,"column":25},"action":"insert","lines":["n"]},{"start":{"row":1,"column":25},"end":{"row":1,"column":26},"action":"insert","lines":["u"]},{"start":{"row":1,"column":26},"end":{"row":1,"column":27},"action":"insert","lines":["m"]},{"start":{"row":1,"column":27},"end":{"row":1,"column":28},"action":"insert","lines":["_"]}],[{"start":{"row":1,"column":28},"end":{"row":1,"column":29},"action":"insert","lines":["c"],"id":3},{"start":{"row":1,"column":29},"end":{"row":1,"column":30},"action":"insert","lines":["o"]},{"start":{"row":1,"column":30},"end":{"row":1,"column":31},"action":"insert","lines":["n"]},{"start":{"row":1,"column":31},"end":{"row":1,"column":32},"action":"insert","lines":["s"]},{"start":{"row":1,"column":32},"end":{"row":1,"column":33},"action":"insert","lines":["t"]},{"start":{"row":1,"column":33},"end":{"row":1,"column":34},"action":"insert","lines":["a"]},{"start":{"row":1,"column":34},"end":{"row":1,"column":35},"action":"insert","lines":["n"]},{"start":{"row":1,"column":35},"end":{"row":1,"column":36},"action":"insert","lines":["t"]},{"start":{"row":1,"column":36},"end":{"row":1,"column":37},"action":"insert","lines":["s"]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":1,"column":60},"end":{"row":1,"column":60},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1588867460842}